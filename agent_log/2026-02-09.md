# Agent Log

## 2026-02-09
- Rebuilt project scaffold (content, src, configs).
- Implemented build/check scripts and Fastify server.
- Added sample content and README instructions.
- Added HTML viewer under /viewer/ (Markdown rendered for humans).
- Fixed viewer routing to use /viewer/ and /viewer/* handlers.
- Scoped compression to Markdown responses only to avoid viewer rendering issues.
- Set viewer HTML responses to no-store to avoid cached partial responses.
- Simplified 404 Markdown to only include breadcrumb + summary (no sibling navigation lists).
- Renamed Breadcrumb label to Navigation across build/check.
- Split viewer into separate service (src/viewer.ts) fetching markdown from MARKDOWN_BASE_URL.
- Markdown server now only serves markdown; viewer runs on its own port.
- 404 navigation now includes full requested path with non-link segments beyond deepest existing dir.
- Fixed check expectations for directory sections to match "## Subdirectories" and "## Pages".
- Recombined viewer onto same port as markdown (separate module, shared server).
- Added shared markdown helpers in src/markdown.ts.
- Split path helpers into src/paths.ts and kept templates in src/markdown.ts.
- Viewer now uses getMarkdownForPath to reuse markdown routing/404 logic via shared function (no route injection).
- Viewer now fetches Markdown via HTTP from MARKDOWN_BASE_URL (Markdown API is the sole source of truth).
- Removed src/markdown.ts and src/paths.ts; kept config.ts and added src/utils.ts for shared helpers.
- Server now owns path/404 logic; viewer only fetches Markdown via HTTP and renders.
- Updated directory nav format to bold labels with descriptions and adjusted checks/docs.
- Updated .gitignore to exclude yarn artifacts and logs; untracked .yarn/install-state.gz and .yarnrc.yml.
- Added build-time backlinks for content pages based on handwritten links (no nav lists).
- Directory nav labels now include descriptions and use bold labels instead of headings.
- Added inline_content_url frontmatter support (build-time inlining with --- separators).
- Inline content is resolved from content sources and participates in backlinks.
- Viewer now counts tokens for markdown responses using tiktoken (model: gpt-5.2; fallback encoding if needed).
- Documented inline_content_url and viewer token display in README.
- inline_content_url no longer requires trailing slash; query/hash are ignored for lookup and normalized to trailing-slash path.
- inline_content_url now accepts full http(s) URLs; internal paths still normalized (query/hash ignored).
- Runtime inlining: server now fetches inline_content_url targets on each request and inserts before navigation elements.
- Internal fetches use MARKDOWN_BASE_URL with x-inline-bypass to avoid recursion.
- Viewer HTML responses now always send a body (no 304) to avoid blank screens with no-store.
- Removed inline_content_url support and runtime inlining.

## 2026-02-10
- Expanded tool documentation into one-page-per-tool under content/docs/agent/tools.
- Rewrote existing tool pages (visit-url, search-token) with consistent contracts and examples.
- Added tool directory overview emphasizing agent-site advantages over a flat tool listing.
- Documented tool page template guidance in README.
- Tweaked viewer code block styling to avoid background artifacts in fenced code.
- Filtered backlinks to exclude pages already linked in the current page body.

## 2026-02-12
- Restructured repository into monorepo-style layout with `apps/`.
- Moved main project into `apps/agent-site-server` (source, content, and project config).
- Created scaffold directories for `apps/agent-browser-skill` and `apps/agent-site-autosearch`.
- Added root workspace `package.json` and root-level README describing project organization.
- Implemented `apps/agent-browser-skill` with `SKILL.md` and `agents/openai.yaml`.
- Added `apps/agent-browser-skill/scripts/curl-with-jwt.sh` for deterministic JWT-authenticated calls.
- Enforced URL allowlist in browser skill helper: `localhost:3000` and `*.sahara.info`.
- Documented `localhost:3000` as Sorin Brain API documentation/source endpoint.
- Removed optional `apps/agent-browser-skill/agents/openai.yaml` metadata per request (skill remains fully functional via `SKILL.md` + script).
- Rebuilt `apps/agent-site-server/content/` from tool-centric docs to an API-book structure optimized for low LLM attention load.
- Added first concrete API page: `/docs/apis/social/` using `https://gcp-dev.saharaa.info/developer/api/agents/tool/social`.
- Added `/docs/apis/blueprint/`, `/docs/apis/cost/`, and `/docs/apis/backlog/` for deterministic scaling to ~20 API pages.
- Updated repository and app READMEs to reflect new API-book architecture and entrypoints.
- Flattened API content paths by lifting docs to content root: `content/apis/*` with runtime URLs under `/apis/*`.
- Removed redundant `content/docs/` layer and rewired internal links/README references to `/apis/`.
- Flattened one level further by lifting API pages directly into `content/*` (no `apis/` folder) with runtime URLs like `/social/`.
- Updated `content/social.md` request examples to explicitly use `apps/agent-browser-skill/scripts/curl-with-jwt.sh` (same flow as localhost docs browsing), including a BTC trend query example.
- Updated browser helper allowlist to support `*.saharaa.info`.
- Added default social query param injection in `curl-with-jwt.sh` for missing `threadId`, `chatId`, and `loopId`.
- Expanded default param injection scope from social-only to all `*.saharaa.info` requests.
- Refined `content/social.md` for minimal LLM attention load: single script-based request path, runtime default params note, minimal-read contract, fixed one-shot output template, and status-code-oriented failure handling.
